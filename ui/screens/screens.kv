# ui/screens/screens.kv
# Phase 0 - Simplified horizontal 1920x1080 layout
# Removed: AgilityGameScreen, QuizGameScreen, QuizButton
# Kept: ScoreScreen, VirtualKeyButton (will be used for karaoke name entry)
#:kivy 2.1.0

# Brand colors
#:set color_primary_blue (0/255, 64/255, 119/255, 1)      # #004077
#:set color_secondary_blue (0/255, 105/255, 180/255, 1)   # #0069B4
#:set color_primary_green (134/255, 188/255, 37/255, 1)   # #86BC25
#:set color_secondary_green (82/255, 174/255, 50/255, 1)  # #52AE32
#:set color_white (1, 1, 1, 1)
#:set color_dark_gray (137/255, 137/255, 137/255, 1)
#:set color_light_gray (216/255, 206/255, 205/255, 1)
#:set screen_padding dp(80)  # Adjusted for horizontal layout

# Base button style
<BrandedButton@Button>:
    font_name: 'Roboto'
    background_color: 0, 0, 0, 0
    color: color_primary_blue
    font_size: '60sp'
    bold: True
    background_normal: ''
    
    canvas.before:
        Color:
            rgba: color_primary_green if self.state == 'normal' else color_secondary_green
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(30)]

# Virtual keyboard button (for ScoreScreen name entry)
<VirtualKeyButton@Button>:
    font_name: 'Roboto'
    background_color: 0, 0, 0, 0
    color: color_white
    font_size: '32sp'
    bold: True
    background_normal: ''
    
    canvas.before:
        Color:
            rgba: (0.3, 0.3, 0.3, 1) if self.state == 'normal' else (0.2, 0.2, 0.2, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(8)]

# Base label style
<BrandedLabel@Label>:
    font_name: 'Roboto'
    color: color_primary_blue
    halign: 'center'
    valign: 'middle'

# --- Screens ---

<WelcomeScreen>:
    name: 'welcome'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    
    FloatLayout:
        Image:
            source: 'assets/images/background_graphic.png'
            allow_stretch: True
            keep_ratio: False
            opacity: 0.15
        
        Image:
            source: 'assets/images/ibp_logo.png'
            size_hint: 0.6, 0.6
            pos_hint: {'center_x': 0.5, 'center_y': 0.55}
        
        BrandedButton:
            text: 'Toque para começar'
            size_hint: 0.5, 0.12
            pos_hint: {'center_x': 0.5, 'center_y': 0.15}
            on_press: app.app_manager.show_instructions()

<CountdownScreen>:
    name: 'countdown'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    
    FloatLayout:
        Image:
            source: 'assets/images/background_graphic.png'
            allow_stretch: True
            keep_ratio: False
            opacity: 0.15
        
        # Countdown number with IBP branding
        Label:
            id: countdown_label
            text: root.label.text if hasattr(root, 'label') else '3'
            font_name: 'Roboto'
            font_size: '250sp'
            bold: True
            color: color_primary_blue
            outline_width: 5
            outline_color: color_primary_green
            halign: 'center'
            valign: 'middle'

<RehearsalScreen>:
    name: 'rehearsal'
    # Video widget added in Python - no canvas.before needed

<CTAScreen>:
    name: 'cta'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    
    FloatLayout:
        Image:
            source: 'assets/images/background_graphic.png'
            allow_stretch: True
            keep_ratio: False
            opacity: 0.15
        
        # IBP Logo at top
        Image:
            source: 'assets/images/ibp_logo_simples.png'
            size_hint: (None, None)
            size: (dp(200), dp(80))
            pos_hint: {'center_x': 0.5, 'top': 0.95}
            allow_stretch: True
            keep_ratio: True
        
        # Content container
        BoxLayout:
            orientation: 'vertical'
            padding: screen_padding
            spacing: dp(40)
            size_hint: (0.8, 0.7)
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            
            # Top spacer
            Widget:
                size_hint_y: 0.1
            
            # Title
            BrandedLabel:
                text: '🎉 ÓTIMO ENSAIO!'
                font_size: '70sp'
                bold: True
                color: color_primary_green
                size_hint_y: 0.2
            
            # Message box
            BoxLayout:
                size_hint_y: 0.4
                padding: dp(40)
                canvas.before:
                    Color:
                        rgba: color_light_gray
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(30)]
                
                BrandedLabel:
                    text: 'Agora é pra valer!\\n\\nCante com confiança e mostre seu talento.\\n\\nPronto para começar?'
                    font_size: '42sp'
                    text_size: self.width, None
                    halign: 'center'
                    valign: 'middle'
            
            # Start button
            BrandedButton:
                text: '▶ VALENDO!'
                size_hint_y: 0.15
                on_press: root.start_performance(self)
            
            # Bottom spacer
            Widget:
                size_hint_y: 0.15

<PerformanceScreen>:
    name: 'performance'
    # Video widget added in Python - no canvas.before needed

<CongratulationsScreen>:
    name: 'congratulations'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    
    FloatLayout:
        Image:
            source: 'assets/images/background_graphic.png'
            allow_stretch: True
            keep_ratio: False
            opacity: 0.15
        
        # IBP Logo at top
        Image:
            source: 'assets/images/ibp_logo_simples.png'
            size_hint: (None, None)
            size: (dp(200), dp(80))
            pos_hint: {'center_x': 0.5, 'top': 0.95}
            allow_stretch: True
            keep_ratio: True
        
        # Content container
        BoxLayout:
            orientation: 'vertical'
            padding: screen_padding
            spacing: dp(40)
            size_hint: (0.8, 0.65)
            pos_hint: {'center_x': 0.5, 'center_y': 0.45}
            
            # Title
            BrandedLabel:
                text: '🎉 PARABÉNS! 🎉'
                font_size: '80sp'
                bold: True
                color: (1, 0.7, 0, 1)
                size_hint_y: 0.3
                outline_width: 3
                outline_color: color_primary_blue
            
            # Message box
            BoxLayout:
                size_hint_y: 0.4
                padding: dp(40)
                canvas.before:
                    Color:
                        rgba: color_light_gray
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(30)]
                
                BrandedLabel:
                    text: 'Você mandou muito bem!\\n\\nObrigado por participar do\\nKaraoke IBP'
                    font_size: '45sp'
                    text_size: self.width, None
                    halign: 'center'
                    valign: 'middle'
            
            # Restart button
            BrandedButton:
                text: '🔄 JOGAR NOVAMENTE'
                size_hint_y: 0.2
                font_size: '45sp'
                on_press: root.restart(self)
            
            # Bottom spacer
            Widget:
                size_hint_y: 0.1

<InstructionsScreen>:
    name: 'instructions'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    
    Image:
        source: 'assets/images/background_graphic.png'
        allow_stretch: True
        keep_ratio: False
        opacity: 0.15
    
    BoxLayout:
        orientation: 'vertical'
        padding: screen_padding
        spacing: dp(30)
        
        # Top spacer
        Widget:
            size_hint_y: 0.15
        
        # Content box
        BoxLayout:
            size_hint_y: 0.5
            padding: dp(50)
            canvas.before:
                Color:
                    rgba: color_light_gray
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(30)]
            
            BoxLayout:
                orientation: 'vertical'
                spacing: dp(20)
                
                BrandedLabel:
                    id: title_label
                    text: root.title_text
                    font_size: '55sp'
                    bold: True
                    size_hint_y: 0.2
                
                BrandedLabel:
                    id: body_label
                    text: root.body_text
                    markup: True
                    font_size: '35sp'
                    text_size: self.width, None
                    size_hint_y: 0.8
                    valign: 'top'
                    halign: 'left'
                    padding: [dp(30), 0]
        
        # Action button
        BrandedButton:
            id: action_button
            text: root.button_text
            size_hint_y: 0.15
            on_press: app.app_manager.proceed_from_instructions()
        
        # Logo
        BoxLayout:
            size_hint_y: 0.1
            
            Image:
                source: 'assets/images/ibp_logo_simples.png'
                size_hint_y: None
                height: dp(60)
                allow_stretch: True
                keep_ratio: True
        
        # Bottom spacer
        Widget:
            size_hint_y: 0.1

<ScoreScreen>:
    name: 'score'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    
    Image:
        source: 'assets/images/background_graphic.png'
        allow_stretch: True
        keep_ratio: False
        opacity: 0.15
    
    BoxLayout:
        orientation: 'vertical'
        padding: screen_padding
        spacing: dp(25)
        
        # Top spacer
        Widget:
            size_hint_y: 0.05
        
        # Score dialog box
        BoxLayout:
            size_hint_y: 0.4
            padding: dp(40)
            canvas.before:
                Color:
                    rgba: color_light_gray
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(30)]
            
            AnchorLayout:
                anchor_y: 'center'
                
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(20)
                    size_hint_y: None
                    height: self.minimum_height
                    
                    BrandedLabel:
                        text: 'Parabéns!'
                        font_size: '60sp'
                        bold: True
                        size_hint_y: None
                        height: self.texture_size[1]
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.width, None
                    
                    BrandedLabel:
                        id: final_score_label
                        text: 'Sua Pontuação Final: 0'
                        font_size: '45sp'
                        bold: True
                        size_hint_y: None
                        height: self.texture_size[1]
                        halign: 'center'
                        valign: 'middle'
                        text_size: self.width, None
                    
                    # Name input section
                    BoxLayout:
                        orientation: 'vertical'
                        spacing: dp(10)
                        size_hint_y: None
                        height: dp(120)
                        
                        BrandedLabel:
                            text: 'Digite seu nome:'
                            font_size: '35sp'
                            size_hint_y: None
                            height: dp(40)
                            halign: 'center'
                            valign: 'middle'
                            text_size: self.width, None
                        
                        TextInput:
                            id: name_input
                            hint_text: 'SEU NOME'
                            font_name: 'Roboto'
                            font_size: '40sp'
                            multiline: False
                            readonly: True
                            halign: 'center'
                            size_hint_y: None
                            height: dp(70)
                            background_color: color_white
                            foreground_color: color_primary_blue
                            cursor_color: color_primary_blue
                            selection_color: color_primary_green
                            padding: [dp(20), dp(15)]
        
        # Submit button
        BoxLayout:
            size_hint_y: 0.15
            padding: [dp(50), 0]
            
            BrandedButton:
                text: 'ENVIAR'
                font_size: '50sp'
                size_hint: 1, 1
                on_press: app.app_manager.submit_score(name_input.text)
        
        # Virtual keyboard
        BoxLayout:
            size_hint_y: 0.4
            padding: [dp(10), 0]
            
            BoxLayout:
                orientation: 'vertical'
                spacing: dp(8)
                
                # Row 1: Numbers and BACKSPACE
                BoxLayout:
                    size_hint_y: 0.2
                    spacing: dp(4)
                    
                    VirtualKeyButton:
                        text: '1'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: '2'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: '3'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: '4'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: '5'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: '6'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: '7'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: '8'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: '9'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: '0'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: '←X'
                        background_color: (0.6, 0.2, 0.2, 1)
                        on_press: app.app_manager.virtual_key_press('BACKSPACE')
                
                # Row 2: QWERTY top row
                BoxLayout:
                    size_hint_y: 0.2
                    spacing: dp(4)
                    
                    Widget:
                        size_hint_x: 0.05
                    VirtualKeyButton:
                        text: 'Q'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'W'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'E'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'R'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'T'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'Y'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'U'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'I'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'O'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'P'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    Widget:
                        size_hint_x: 0.05
                
                # Row 3: ASDF middle row
                BoxLayout:
                    size_hint_y: 0.2
                    spacing: dp(4)
                    
                    Widget:
                        size_hint_x: 0.1
                    VirtualKeyButton:
                        text: 'A'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'S'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'D'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'F'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'G'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'H'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'J'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'K'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'L'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    Widget:
                        size_hint_x: 0.1
                
                # Row 4: ZXCV bottom row + ENTER
                BoxLayout:
                    size_hint_y: 0.2
                    spacing: dp(4)
                    
                    Widget:
                        size_hint_x: 0.15
                    VirtualKeyButton:
                        text: 'Z'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'X'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'C'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'V'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'B'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'N'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: 'M'
                        on_press: app.app_manager.virtual_key_press(self.text)
                    VirtualKeyButton:
                        text: '↵'
                        size_hint_x: 2.5
                        background_color: color_primary_green
                        on_press: app.app_manager.virtual_key_press('ENTER')
                    Widget:
                        size_hint_x: 0.15
                
                # Row 5: Spacebar
                BoxLayout:
                    size_hint_y: 0.2
                    spacing: dp(4)
                    
                    Widget:
                        size_hint_x: 0.2
                    VirtualKeyButton:
                        text: '▢'
                        size_hint_x: 0.6
                        font_size: '20sp'
                        on_press: app.app_manager.virtual_key_press('SPACE')
                    Widget:
                        size_hint_x: 0.2

<LeaderboardScreen>:
    name: 'leaderboard'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    
    Image:
        source: 'assets/images/background_graphic.png'
        allow_stretch: True
        keep_ratio: False
        opacity: 0.15
    
    BoxLayout:
        orientation: 'vertical'
        padding: screen_padding
        spacing: dp(20)
        
        # Title
        BrandedLabel:
            text: 'Ranking de Hoje'
            font_size: '65sp'
            bold: True
            size_hint_y: 0.12
            color: color_primary_blue
        
        # Congratulations message
        BrandedLabel:
            id: congrats_label
            text: ''
            font_size: '32sp'
            size_hint_y: 0.06
            color: color_primary_green
            bold: True
        
        # Leaderboard container
        BoxLayout:
            size_hint_y: 0.68
            padding: dp(25)
            canvas.before:
                Color:
                    rgba: color_light_gray
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(20)]
            
            ScrollView:
                do_scroll_x: False
                do_scroll_y: True
                
                GridLayout:
                    id: leaderboard_grid
                    cols: 3
                    spacing: dp(10)
                    size_hint_y: None
                    height: self.minimum_height
                    row_default_height: dp(45)
        
        # Return button
        BrandedButton:
            text: 'Voltar ao Início'
            size_hint_y: 0.14
            font_size: '48sp'
            on_press: app.app_manager.return_to_welcome()